<div class="palette-wrapper" #paletteWrapper>
<mat-accordion multi>
    <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
            <mat-panel-title>Nodi</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="palette-section">
            <mat-form-field appearance="outline" class="search-bar">
                <mat-label>Search</mat-label>
                <input matInput [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange($event)">
                <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
            <button mat-flat-button color="primary" class="import-button" (click)="triggerImportAction()">
              <mat-icon>file_upload</mat-icon>
              <span>Importa</span>
            </button>
            <input #actionFileInput type="file" accept="application/json" (change)="onActionFileSelected($event)" hidden />
            <!-- La griglia ora itera su un Observable usando la pipe async -->
            <div class="palette-grid" *ngIf="filteredNodeActions$ | async as nodeActions">
                <div *ngFor="let action of nodeActions" class="palette-item node-item" draggable="true"
                    (dragstart)="onDragStart($event, action)" (contextmenu)="onContextMenu($event, action)">
                    <div class="shape-container">
                      <div class="node-shape" [ngClass]="action.icon" [style.background]="action.defaultColor"></div>
                    </div>
                    <div class="node-name">{{ action.name }}</div>
                </div>
            </div>
        </div>
    </mat-expansion-panel>
    <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
            <mat-panel-title>Archi</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="palette-list" *ngIf="edgeActions$ | async as edgeActions">
            <div *ngFor="let edge of edgeActions" class="palette-item edge-item" (click)="selectEdgeType(edge.type)"
                [class.selected]="(graphState.currentEdgeType | async) === edge.type">
                <mat-icon>{{edge.icon}}</mat-icon>
                <span>{{edge.name}}</span>
            </div>
        </div>
    </mat-expansion-panel>
</mat-accordion>
<div *ngIf="contextMenuAction" #contextMenu class="context-menu" [style.top.px]="contextMenuY" [style.left.px]="contextMenuX" (click)="$event.stopPropagation()">
  <button mat-button color="warn" (click)="handleDeleteFromMenu()">Elimina dal server</button>
</div>
</div>
